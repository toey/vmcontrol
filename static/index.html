<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VM Control Panel</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header>
        <h1>VM Control Panel</h1>
        <p class="subtitle">QEMU / KVM Management</p>
    </header>

    <nav id="tabs">
        <button class="tab active" data-tab="start">Start</button>
        <button class="tab" data-tab="stop">Stop</button>
        <button class="tab" data-tab="reset">Reset</button>
        <button class="tab" data-tab="powerdown">Powerdown</button>
        <button class="tab" data-tab="create">Create</button>
        <button class="tab" data-tab="copyimage">Copy Image</button>
        <button class="tab" data-tab="listimage">List Image</button>
        <button class="tab" data-tab="delete">Delete</button>
        <button class="tab" data-tab="mountiso">Mount ISO</button>
        <button class="tab" data-tab="livemigrate">Live Migrate</button>
        <button class="tab" data-tab="backup">Backup</button>
        <button class="tab" data-tab="vnc-start">VNC Start</button>
        <button class="tab" data-tab="vnc-stop">VNC Stop</button>
        <button class="tab" data-tab="metadata">Metadata</button>
    </nav>

    <main>
        <!-- Start VM -->
        <div id="tab-start" class="tab-panel active">
            <h2>Start VM</h2>
            <div class="form-grid">
                <fieldset>
                    <legend>CPU</legend>
                    <label>Sockets <input type="text" id="start-cpu-sockets" value="1"></label>
                    <label>Cores <input type="text" id="start-cpu-cores" value="2"></label>
                    <label>Threads <input type="text" id="start-cpu-threads" value="1"></label>
                </fieldset>
                <fieldset>
                    <legend>Memory</legend>
                    <label>Size (MB) <input type="text" id="start-memory-size" value="2048"></label>
                </fieldset>
                <fieldset>
                    <legend>Features</legend>
                    <label>Is Windows
                        <select id="start-is-windows">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </label>
                </fieldset>
            </div>
            <fieldset>
                <legend>Network Adapters</legend>
                <div id="start-network-adapters"></div>
                <button type="button" class="btn-add" onclick="addNetworkAdapter()">+ Add Adapter</button>
            </fieldset>
            <fieldset>
                <legend>Disks</legend>
                <div id="start-disks"></div>
                <button type="button" class="btn-add" onclick="addDisk()">+ Add Disk</button>
            </fieldset>
            <button class="execute-btn" onclick="executeStart()">Start VM</button>
        </div>

        <!-- Stop -->
        <div id="tab-stop" class="tab-panel">
            <h2>Stop VM</h2>
            <label>SMAC <select id="stop-smac"><option value="">-- select VM --</option></select></label>
            <button class="execute-btn" onclick="executeSimple('stop')">Stop VM</button>
        </div>

        <!-- Reset -->
        <div id="tab-reset" class="tab-panel">
            <h2>Reset VM</h2>
            <label>SMAC <select id="reset-smac"><option value="">-- select VM --</option></select></label>
            <button class="execute-btn" onclick="executeSimple('reset')">Reset VM</button>
        </div>

        <!-- Powerdown -->
        <div id="tab-powerdown" class="tab-panel">
            <h2>Powerdown VM</h2>
            <label>SMAC <select id="powerdown-smac"><option value="">-- select VM --</option></select></label>
            <button class="execute-btn" onclick="executeSimple('powerdown')">Powerdown VM</button>
        </div>

        <!-- Create -->
        <div id="tab-create" class="tab-panel">
            <h2>Create Disk</h2>
            <label>SMAC <input type="text" id="create-smac" placeholder="52-54-c4-ca-42-38"></label>
            <label>Size <input type="text" id="create-size" placeholder="40G"></label>
            <button class="execute-btn" onclick="executeCreate()">Create Disk</button>
        </div>

        <!-- Copy Image -->
        <div id="tab-copyimage" class="tab-panel">
            <h2>Copy Image</h2>
            <label>Template <input type="text" id="copyimage-itemplate" placeholder="CentOS-7-x86_64-GenericCloud-1907"></label>
            <label>SMAC <input type="text" id="copyimage-smac" placeholder="52-54-c4-ca-42-38"></label>
            <label>Size <input type="text" id="copyimage-size" placeholder="40G"></label>
            <button class="execute-btn" onclick="executeCopyImage()">Copy Image</button>
        </div>

        <!-- List Image -->
        <div id="tab-listimage" class="tab-panel">
            <h2>List Images</h2>
            <label>SMAC <select id="listimage-smac"><option value="">-- select VM --</option></select></label>
            <button class="execute-btn" onclick="executeSimple('listimage')">List Images</button>
        </div>

        <!-- Delete -->
        <div id="tab-delete" class="tab-panel">
            <h2>Delete VM</h2>
            <label>SMAC <select id="delete-smac"><option value="">-- select VM --</option></select></label>
            <button class="execute-btn" onclick="executeSimple('delete')">Delete VM</button>
        </div>

        <!-- Mount ISO -->
        <div id="tab-mountiso" class="tab-panel">
            <h2>Mount ISO</h2>
            <label>SMAC <select id="mountiso-smac"><option value="">-- select VM --</option></select></label>
            <label>ISO Name <input type="text" id="mountiso-isoname" placeholder="CentOS-7-x86_64-Minimal-1810.iso"></label>
            <div class="btn-group">
                <button class="execute-btn" onclick="executeMountIso()">Mount ISO</button>
                <button class="execute-btn btn-unmount" onclick="executeUnmountIso()">Unmount ISO</button>
            </div>
        </div>

        <!-- Live Migrate -->
        <div id="tab-livemigrate" class="tab-panel">
            <h2>Live Migrate</h2>
            <label>SMAC <select id="livemigrate-smac"><option value="">-- select VM --</option></select></label>
            <label>To Node IP <input type="text" id="livemigrate-to-node-ip" placeholder="10.40.1.32"></label>
            <button class="execute-btn" onclick="executeLiveMigrate()">Live Migrate</button>
        </div>

        <!-- Backup -->
        <div id="tab-backup" class="tab-panel">
            <h2>Backup VM</h2>
            <label>SMAC <select id="backup-smac"><option value="">-- select VM --</option></select></label>
            <button class="execute-btn" onclick="executeSimple('backup')">Backup VM</button>
        </div>
        <!-- VNC Start -->
        <div id="tab-vnc-start" class="tab-panel">
            <h2>VNC Start</h2>
            <p class="form-desc">Start noVNC websockify proxy for VM console access</p>
            <label>SMAC <select id="vnc-start-smac"><option value="">-- select VM --</option></select></label>
            <label>noVNC Port <input type="text" id="vnc-start-novncport" placeholder="12001"></label>
            <div class="btn-group">
                <button class="execute-btn" onclick="executeVnc('start')">Start VNC Proxy</button>
                <button class="execute-btn btn-console" onclick="openConsole()">Open Console</button>
            </div>
            <div id="vnc-console-link" style="display:none; margin-top:12px;">
                <a id="vnc-console-url" href="#" target="_blank" class="console-link">ðŸ–¥ Open VM Console in new tab</a>
            </div>
        </div>

        <!-- VNC Stop -->
        <div id="tab-vnc-stop" class="tab-panel">
            <h2>VNC Stop</h2>
            <p class="form-desc">Stop noVNC websockify proxy</p>
            <label>SMAC <select id="vnc-stop-smac"><option value="">-- select VM --</option></select></label>
            <label>noVNC Port <input type="text" id="vnc-stop-novncport" placeholder="12001"></label>
            <button class="execute-btn" onclick="executeVnc('stop')">Stop VNC Proxy</button>
        </div>

        <!-- Metadata Service -->
        <div id="tab-metadata" class="tab-panel">
            <h2>Metadata Service (MDS)</h2>
            <p class="form-desc">EC2-compatible instance metadata configuration</p>
            <fieldset>
                <legend>Instance Identity</legend>
                <label>Instance ID <input type="text" id="mds-instance-id" placeholder="i-0000000000000001"></label>
                <label>AMI ID <input type="text" id="mds-ami-id" placeholder="ami-00000001"></label>
                <label>Hostname Prefix <input type="text" id="mds-hostname-prefix" placeholder="vm"></label>
            </fieldset>
            <fieldset>
                <legend>Network</legend>
                <label>Local IPv4 <input type="text" id="mds-local-ipv4" placeholder="10.0.0.1"></label>
                <label>Default MAC <input type="text" id="mds-default-mac" placeholder="52:54:00:00:00:01"></label>
            </fieldset>
            <fieldset>
                <legend>Cloud-Init</legend>
                <label>SSH Public Key <input type="text" id="mds-ssh-pubkey" placeholder="ssh-rsa AAAA..."></label>
                <label>Root Password <input type="text" id="mds-root-password" placeholder="changeme"></label>
                <label>Extra Userdata (YAML)
                    <textarea id="mds-userdata-extra" rows="5" placeholder="# Additional cloud-init YAML"></textarea>
                </label>
            </fieldset>
            <div class="btn-group">
                <button class="execute-btn" onclick="saveMdsConfig()">Save Config</button>
                <button class="execute-btn btn-console" onclick="loadMdsConfig()">Load Config</button>
            </div>
        </div>
    </main>

    <section id="output-section">
        <h3>Output</h3>
        <div id="status-indicator"></div>
        <pre id="output">Ready.</pre>
    </section>

    <script src="/app.js"></script>
</body>
</html>
